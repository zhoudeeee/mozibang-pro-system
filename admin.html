<!DOCTYPE html>
<html>
<head>
    <title>MoziBang 订单管理</title>
    <meta charset="utf-8">
</head>
<body>
    <div class="admin-container">
        <h2>订单激活管理</h2>
        
        <div class="activate-form">
            <input type="text" id="user-id-input" placeholder="输入用户ID (如: a8b3c4d5e6)">
            <button onclick="activateUser()">激活Pro版本</button>
        </div>
        
        <div id="result"></div>
    </div>
    
    <script>
        async function activateUser() {
            const userId = document.getElementById('user-id-input').value.trim();
            if (!userId) {
                alert('请输入用户ID');
                return;
            }
            
            try {
                // 创建许可证数据
                const licenseData = {
                    license: "pro",
                    expire: null,
                    activated: new Date().toISOString(),
                    sig: await generateSignature(userId)
                };
                
                // 使用GitHub API创建许可证文件
                await createLicenseFile(userId, licenseData);
                
                document.getElementById('result').innerHTML = 
                    `<p style="color: green;">✅ 用户 ${userId} 已成功激活Pro版本</p>`;
                    
            } catch (error) {
                document.getElementById('result').innerHTML = 
                    `<p style="color: red;">❌ 激活失败: ${error.message}</p>`;
            }
        }
        
        async function createLicenseFile(userId, licenseData) {
            const token = 'your_github_token'; // 需要配置
            const repo = 'your_username/your_repo';
            
            const response = await fetch(`https://api.github.com/repos/${repo}/contents/licenses/${userId}.json`, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: `Activate Pro license for ${userId}`,
                    content: btoa(JSON.stringify(licenseData, null, 2))
                })
            });
            
            if (!response.ok) {
                throw new Error('GitHub API调用失败');
            }
        }
        
        async function generateSignature(userId) {
            // 简化的签名生成，实际应使用RSA
            return btoa(userId + '_' + Date.now());
        }
    </script>
</body>
</html>